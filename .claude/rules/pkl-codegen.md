# PKL Codegen (pkl-swift)

Config types are generated by `pkl-gen-swift` from PKL schemas. DO NOT edit `Sources/ExFigConfig/Generated/*.pkl.swift` manually.

## Regeneration

```bash
./bin/mise run codegen:pkl   # requires pkl-gen-swift installed
```

Schemas: `Sources/ExFigCLI/Resources/Schemas/{ExFig,Common,Figma,iOS,Android,Flutter,Web}.pkl`
Output: `Sources/ExFigConfig/Generated/*.pkl.swift` (committed to repo)

## Type Mapping

| PKL | Swift Generated |
|-----|----------------|
| `module Foo` | `enum Foo {}` (namespace) |
| `class Bar` in module Foo | `Foo.Bar` struct |
| `Listing<T>?` | `[T]?` |
| `open class` | protocol + `*Impl` struct |
| `typealias` union | `enum: String, CaseIterable` |
| `Number?` | `Double?` |

## Enum Bridging

Generated enums (e.g., `Common.NameStyle`) use PKL raw values — `.snake_case`, NOT `.snakeCase`.

Bridge to ExFigCore enums via rawValue:
```swift
entry.coreNameStyle   // Common.NameStyle → ExFigCore.NameStyle
entry.coreRenderMode  // iOS.XcodeRenderMode → ExFigCore.XcodeRenderMode
```

Convenience properties live in `Sources/ExFig-*/Config/*Entry.swift` extensions.

## URL Bridging

Generated types use `String?` for paths. Convenience URL properties:
- `entry.colorSwiftURL`, `entry.imageSwiftURL`, `entry.swiftUIImageSwiftURL`
- `platform.outputURL`, `platform.templatesPathURL`, `platform.mainResURL`

URL bridging lives in `Sources/ExFigCLI/Input/PKLConfigCompat.swift` and platform entry files.

## SwiftLint

`Sources/ExFigConfig/Generated/` is excluded in `.swiftlint.yml` — generated code triggers false positives.

## Test Fixtures

PKL test fixtures in `Tests/ExFigTests/Fixtures/PKL/`. Entry fields are always arrays (`Listing`), never single objects.

JSON test fixtures (FileIdProviderTests) must use array format for entries:
```json
"colors": [{ "tokensFileId": "..." }]   // correct
"colors": { "tokensFileId": "..." }     // wrong — was legacy single-entry format
```
